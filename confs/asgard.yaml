substitutions:
  uart_rx_pin: 38
  uart_tx_pin: 39
  uart_proxy_rx_pin: 8
  uart_proxy_tx_pin: 7

esphome:
  name: ${name}
  friendly_name: ${friendlyName}
  platformio_options:
    board_build.flash_mode: dio

esp32:
  board: esp32-s3-devkitc-1
  flash_size: 8MB
  cpu_frequency: 240MHz
  framework:
    type: esp-idf
    version: recommended
    # Custom sdkconfig options
    sdkconfig_options:
      COMPILER_OPTIMIZATION_SIZE: y
      CONFIG_BT_ENABLED: n
      CONFIG_FREERTOS_USE_TRACE_FACILITY: y
      CONFIG_FREERTOS_GENERATE_RUN_TIME_STATS: y
      CONFIG_FREERTOS_USE_STATS_FORMATTING_FUNCTIONS: y

uart:
  - id: uart_ecodan
    rx_pin:
      number: GPIO${uart_rx_pin}
      mode:
        input: true
        pullup: true
    tx_pin:
      number: GPIO${uart_tx_pin}
      mode:
        output: true
    baud_rate: 2400
    parity: EVEN
    stop_bits: 1
    debug:
      direction: BOTH
      dummy_receiver: false
      after:
        delimiter: "\n"
      sequence:
        - lambda: UARTDebug::log_hex(direction, bytes, ' ');

  - id: uart_proxy
    rx_pin:
      number: GPIO${uart_proxy_rx_pin}
      mode:
        input: true
        pullup: true
    tx_pin:
      number: GPIO${uart_proxy_tx_pin}
      mode:
        output: true
    baud_rate: 9600
    parity: EVEN
    stop_bits: 1
    debug:
      direction: BOTH
      dummy_receiver: false
      after:
        delimiter: "\n"
      sequence:
        - lambda: UARTDebug::log_hex(direction, bytes, '_');  

ecodan:
  uart_id: uart_main
  proxy_uart_id: uart_proxy

###  ESP restart button
button:
  - platform: restart
    id: restart_button
    name: ${restart_button}

one_wire:
  - platform: gpio
    pin: GPIO02
    id: dallas_bus

sensor:
  - platform: internal_temperature
    name: ${internal_esp_temperature}
    entity_category: diagnostic
    unit_of_measurement: "Â°C"
    device_class: temperature
    accuracy_decimals: 1

  # single
  - platform: dallas_temp
    name: temperature
    update_interval: 120s

# relay
switch:
  - platform: gpio
    pin: GPIO40
    restore_mode: RESTORE_DEFAULT_OFF
    id: relay_1
    name: Relay 1

  - platform: gpio
    pin: GPIO41
    restore_mode: RESTORE_DEFAULT_OFF
    id: relay_2
    name: Relay 2

<<: !include asgard-led.yaml